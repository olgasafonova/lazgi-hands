<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Ikat Pattern v9 - Multiple Shapes</title>
  <style>
    body { margin: 0; background: #f5f0e6; overflow: hidden; }
    #info {
      position: absolute;
      top: 20px;
      left: 20px;
      color: #1a237e;
      font-family: system-ui;
      font-size: 14px;
      z-index: 100;
    }
  </style>
</head>
<body>
  <div id="info">
    <h2>Ikat v9: Multiple Shapes</h2>
    <p>Medallions, spirals, and fan sprays</p>
    <p>Move mouse to draw</p>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/p5@1.9.0/lib/p5.min.js"></script>
  <script>
    const IKAT_COLORS = [
      [0, 131, 143],    // turquoise
      [183, 28, 28],    // crimson
      [255, 193, 7],    // gold
      [106, 27, 154],   // purple
      [26, 35, 126],    // indigo
      [233, 30, 99],    // magenta
      [46, 125, 50],    // green
      [27, 94, 32],     // dark green
      [0, 150, 136],    // teal green
      [33, 150, 243],   // blue
      [13, 71, 161],    // dark blue
      [3, 169, 244],    // light blue
      [20, 20, 20],     // black
      [250, 250, 250],  // white
    ];

    const BG_COLOR = [245, 240, 230];
    const SHAPES = ['medallion', 'spiral', 'fan'];

    let shapes = [];
    let prevMouse = { x: 0, y: 0 };

    function setup() {
      createCanvas(windowWidth, windowHeight);
      colorMode(RGB);
      noStroke();
    }

    function draw() {
      background(BG_COLOR[0], BG_COLOR[1], BG_COLOR[2], 10);

      if (mouseX > 0 && mouseY > 0) {
        const dist = Math.sqrt(
          Math.pow(mouseX - prevMouse.x, 2) +
          Math.pow(mouseY - prevMouse.y, 2)
        );

        if (dist > 15) {
          spawnShape(mouseX, mouseY);
          prevMouse = { x: mouseX, y: mouseY };
        }
      }

      updateShapes();
      drawShapes();
    }

    function spawnShape(x, y) {
      const color1 = IKAT_COLORS[floor(random(IKAT_COLORS.length))];
      let color2 = IKAT_COLORS[floor(random(IKAT_COLORS.length))];
      while (color2 === color1) {
        color2 = IKAT_COLORS[floor(random(IKAT_COLORS.length))];
      }

      const shapeType = SHAPES[floor(random(SHAPES.length))];

      shapes.push({
        x: x,
        y: y,
        type: shapeType,
        color1: color1,
        color2: color2,
        width: random(80, 130),
        height: random(180, 300),
        life: 1,
        decay: random(0.002, 0.005),
        mirror: random() > 0.5  // Some shapes mirrored
      });

      if (shapes.length > 60) shapes.shift();
    }

    function updateShapes() {
      for (let i = shapes.length - 1; i >= 0; i--) {
        const s = shapes[i];
        s.life -= s.decay;

        if (s.life <= 0) {
          shapes.splice(i, 1);
        }
      }
    }

    function drawShapes() {
      for (const s of shapes) {
        push();
        translate(s.x, s.y);

        switch(s.type) {
          case 'medallion':
            drawMedallion(s);
            break;
          case 'spiral':
            drawSpiral(s);
            break;
          case 'fan':
            drawFan(s);
            break;
        }

        pop();
      }
    }

    // === MEDALLION (existing) ===
    function drawMedallion(s) {
      const alpha = s.life * 255;
      drawTexturedMedallion(0, 0, s.width, s.height, s.color1, alpha);
      drawTexturedMedallion(0, 0, s.width * 0.5, s.height * 0.55, s.color2, alpha);
      fill(BG_COLOR[0], BG_COLOR[1], BG_COLOR[2], alpha);
      ellipse(0, 0, s.width * 0.15, s.height * 0.12);
    }

    function drawTexturedMedallion(cx, cy, w, h, baseColor, alpha) {
      const stripeW = 4;
      const numStripes = ceil(w / stripeW) + 2;

      for (let i = -numStripes/2; i <= numStripes/2; i++) {
        const stripeX = i * stripeW;
        if (abs(stripeX) > w/2 + stripeW) continue;

        const stripeBrightness = (i % 2 === 0) ? 0 : 20;
        const abrash = sin(i * 1.7) * 10;

        fill(
          constrain(baseColor[0] + stripeBrightness + abrash, 0, 255),
          constrain(baseColor[1] + stripeBrightness + abrash, 0, 255),
          constrain(baseColor[2] + stripeBrightness + abrash, 0, 255),
          alpha
        );

        const t = abs(stripeX) / (w/2 + 1);
        const stripeH = h * Math.pow(1 - t, 0.6);

        if (stripeH > 2) {
          beginShape();
          vertex(cx + stripeX, cy - stripeH/2);
          vertex(cx + stripeX + stripeW/2, cy);
          vertex(cx + stripeX, cy + stripeH/2);
          vertex(cx + stripeX - stripeW/2, cy);
          endShape(CLOSE);
        }
      }
    }

    // === SPIRAL (Ram's horn) ===
    function drawSpiral(s) {
      const alpha = s.life * 255;

      // Draw pair of spirals (mirrored)
      drawSingleSpiral(0, 0, s.width * 0.6, s.height * 0.5, s.color1, alpha, 1);
      drawSingleSpiral(0, 0, s.width * 0.6, s.height * 0.5, s.color1, alpha, -1);

      // Inner spiral detail
      drawSingleSpiral(0, 0, s.width * 0.35, s.height * 0.3, s.color2, alpha, 1);
      drawSingleSpiral(0, 0, s.width * 0.35, s.height * 0.3, s.color2, alpha, -1);
    }

    function drawSingleSpiral(cx, cy, w, h, color, alpha, dir) {
      const stripeW = 4;

      // Spiral curve - starts at center, curls outward
      for (let t = 0; t < 1; t += 0.03) {
        const angle = t * PI * 1.5;  // How much it curls
        const radius = t * w;

        const x = cx + dir * (cos(angle) * radius * 0.5 + t * w * 0.3);
        const y = cy - sin(angle) * radius * 0.8 - t * h * 0.3;

        const thickness = (1 - t * 0.5) * w * 0.3;

        // Vertical stripe texture
        const stripeBrightness = (floor(t * 20) % 2 === 0) ? 0 : 20;

        fill(
          constrain(color[0] + stripeBrightness, 0, 255),
          constrain(color[1] + stripeBrightness, 0, 255),
          constrain(color[2] + stripeBrightness, 0, 255),
          alpha * (1 - t * 0.3)
        );

        // Draw as elongated ellipse
        push();
        translate(x, y);
        rotate(angle * dir);
        ellipse(0, 0, stripeW, thickness);
        pop();
      }
    }

    // === FAN (Feather spray) ===
    function drawFan(s) {
      const alpha = s.life * 255;
      const numFeathers = 7;

      // Central stem
      fill(s.color1[0], s.color1[1], s.color1[2], alpha);
      beginShape();
      vertex(0, s.height * 0.3);
      vertex(4, 0);
      vertex(0, -s.height * 0.1);
      vertex(-4, 0);
      endShape(CLOSE);

      // Fan feathers radiating upward
      for (let i = 0; i < numFeathers; i++) {
        const t = (i - (numFeathers - 1) / 2) / ((numFeathers - 1) / 2);  // -1 to 1
        const angle = t * PI * 0.4;  // Spread angle

        const featherLen = s.height * (0.5 - abs(t) * 0.15);
        const featherW = s.width * 0.08;

        push();
        rotate(angle);

        // Outer feather
        drawFeather(0, -featherLen * 0.3, featherW, featherLen, s.color1, alpha);

        // Inner feather detail
        drawFeather(0, -featherLen * 0.25, featherW * 0.5, featherLen * 0.7, s.color2, alpha);

        pop();
      }
    }

    function drawFeather(cx, cy, w, h, color, alpha) {
      const stripes = 8;

      for (let i = 0; i < stripes; i++) {
        const t = i / stripes;
        const y = cy - t * h;
        const segW = w * (1 - t * 0.7);
        const segH = h / stripes + 2;

        const stripeBrightness = (i % 2 === 0) ? 0 : 25;

        fill(
          constrain(color[0] + stripeBrightness, 0, 255),
          constrain(color[1] + stripeBrightness, 0, 255),
          constrain(color[2] + stripeBrightness, 0, 255),
          alpha
        );

        // Pointed segment
        beginShape();
        vertex(cx, y + segH/2);
        vertex(cx + segW/2, y);
        vertex(cx, y - segH/2);
        vertex(cx - segW/2, y);
        endShape(CLOSE);
      }
    }

    function windowResized() {
      resizeCanvas(windowWidth, windowHeight);
    }
  </script>
</body>
</html>
